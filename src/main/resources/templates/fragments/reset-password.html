<div th:fragment="reset-password-fragment" id="reset-container" class="fade-in">

    <div th:if="${success}" class="card border-0 shadow-sm p-5 text-center rounded-4">
        <div class="mb-4">
            <div class="bg-success bg-opacity-10 text-success d-inline-flex align-items-center justify-content-center rounded-circle" style="width: 80px; height: 80px;">
                <i class="fas fa-check-circle fa-3x"></i>
            </div>
        </div>
        <h3 class="fw-bold text-dark" th:text="#{common.ready}">Готово!</h3>
        <p class="text-muted mb-4" th:text="${message}">Ваш пароль успішно оновлено.</p>

        <button class="btn btn-primary btn-lg rounded-pill px-5 shadow-sm"
                th:attr="hx-get=@{/user/profile/{id}(id=${#authentication.principal.id})}"
                hx-target="#content-area"
                th:text="#{user.profile.back}">
            Повернутися до профілю
        </button>
    </div>

    <div th:if="${success == null}" class="card border-0 shadow-sm p-4 rounded-4">
        <div class="d-flex align-items-center gap-3 mb-4">
            <div class="bg-danger bg-opacity-10 text-danger p-3 rounded-3">
                <i class="fas fa-shield-alt fa-lg"></i>
            </div>
            <div>
                <h4 class="fw-bold m-0" th:text="#{auth.reset.create_new}">Новий пароль</h4>
                <p class="text-muted small m-0" th:text="#{auth.reset.hint}">Створіть надійний пароль для захисту акаунту</p>
            </div>
        </div>

        <form th:object="${resetPasswordRequest}"
              hx-post="/auth/reset-password/confirm"
              hx-target="#reset-container"
              hx-swap="outerHTML"
              hx-indicator="#loading-spinner">

            <div class="mb-4">
                <label class="form-label fw-semibold small" th:text="#{auth.reset.new_pass}">Новий пароль</label>
                <div class="input-group">
                    <span class="input-group-text bg-light border-0 text-muted">
                        <i class="fas fa-lock"></i>
                    </span>
                    <input type="password"
                           th:field="*{newPassword}"
                           class="form-control bg-light border-0 py-2 shadow-none"
                           th:placeholder="#{auth.reset.placeholder_min}"
                           th:classappend="${#fields.hasErrors('newPassword')} ? 'is-invalid' : ''"
                           required>
                    <div class="invalid-feedback" th:errors="*{newPassword}">Error</div>
                </div>
                <div class="form-text mt-2 small">
                    <i class="fas fa-info-circle me-1"></i> Мінімум 8 символів, великі літери та цифри.
                </div>
            </div>

            <div class="mb-4">
                <label class="form-label fw-semibold small" th:text="#{auth.reset.confirm_pass}">Підтвердження</label>
                <div class="input-group">
                    <span class="input-group-text bg-light border-0 text-muted">
                        <i class="fas fa-check-double"></i>
                    </span>
                    <input type="password"
                           name="confirmPassword"
                           class="form-control bg-light border-0 py-2 shadow-none"
                           th:placeholder="#{auth.reset.placeholder_repeat}"
                           required>
                </div>
            </div>

            <div class="d-flex align-items-center gap-3">
                <button type="submit" class="btn btn-danger btn-lg px-4 rounded-3 shadow-sm fw-bold">
                    <span th:text="#{auth.reset.btn_update}">Оновити пароль</span>
                </button>

                <div id="loading-spinner" class="htmx-indicator">
                    <div class="spinner-border spinner-border-sm text-danger" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>